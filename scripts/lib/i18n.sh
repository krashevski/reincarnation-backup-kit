#!/usr/bin/env bash
# =============================================================
# /scriptslib/i18n.sh — интернационализация и определение языка
# =============================================================

# -------------------------------------------------------------
# detect_system_lang
# Определяет системный язык: ru, en, ja
# -------------------------------------------------------------
detect_system_lang() {
    local lang

    # Приоритет: LC_ALL > LANG
    lang="${LC_ALL:-${LANG:-}}"

    # Если язык не определён
    [[ -z "$lang" ]] && {
        echo "en"
        return
    }

    # ru_RU.UTF-8 → ru, ja_JP.UTF-8 → ja
    lang="${lang%%_*}"
    lang="${lang,,}"  # в нижний регистр

    case "$lang" in
        en|ru|ja)  # теперь поддерживается японский
            echo "$lang"
            ;;
        *)
            echo "en"  # язык по умолчанию
            ;;
    esac
}

# -------------------------------------------------------------
# init_app_lang
# Инициализация APP_LANG (если не задан)
# -------------------------------------------------------------
init_app_lang() {
    if [[ -z "${APP_LANG:-}" ]]; then
        APP_LANG="$(detect_system_lang)"
        export APP_LANG
    fi
}

# Экспорт API — объявляем функции как read-only (без ошибок в Bash)
declare -fr detect_system_lang init_app_lang