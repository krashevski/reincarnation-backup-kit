# REBK Lib ‚Äî –ú–∏–Ω–∏-README

[üá¨üáß English](../EN/README_REBK_LIB_EN.md) | [üá∑üá∫ –†—É—Å—Å–∫–∏–π]()

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–∫–∏ lib

`lib/`
‚îú‚îÄ `logging.sh`       # –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ + i18n + —Ü–≤–µ—Ç–∞
‚îú‚îÄ `deps.sh `         # –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îî‚îÄ (–¥–æ–ø. –º–æ–¥—É–ª–∏)   # `utils`, `guards`, `locks` –∏ –¥—Ä.

## 1Ô∏è‚É£ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ —Å–∫—Ä–∏–ø—Ç–µ REBK

```bash
#!/usr/bin/env bash
```

```bash
# –ø—É—Ç—å –∫ lib
LIB_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/lib" && pwd)"
```

```bash
# –ø–æ–¥–∫–ª—é—á–∞–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ i18n
source "$LIB_DIR/logging.sh"
```

```bash
# –ø–æ–¥–∫–ª—é—á–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
source "$LIB_DIR/deps.sh"
```

> –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏:
> `ok`/`info`/`warn`/`error`/`die`
> `say(key, ...)`
> `check_and_install_deps(...)`

## 2Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å i18n

### 2.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —è–∑—ã–∫–∞
```bash
# –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ru
LANG_CODE="${LANG_CODE:-ru}"
load_messages "$LANG_CODE"
```

### 2.2 –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
ok deps_ok                    # [OK] –°–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ MSG['deps_ok']
info deps_install_try          # [INFO] –ü–æ–ø—ã—Ç–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π‚Ä¶
warn deps_missing_list "rsync tar gzip"
error no_script "$DISTRO" "$VERSION" "$TARGET"
die 2 "fatal_error_occurred"
```

> –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ—Ä—É—Ç—Å—è –∏–∑ `MSG[]` –≤ `i18n/messages_ru.sh` –∏–ª–∏ `messages_en.sh`.

### 3Ô∏è‚É£ –§—É–Ω–∫—Ü–∏—è say()
- –§–æ—Ä–º–∞—Ç: `say <key> [args...]`
- –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤ —à–∞–±–ª–æ–Ω `i18n` —á–µ—Ä–µ–∑ `printf`

–ü—Ä–∏–º–µ—Ä –≤ messages_ru.sh:
```bash
MSG[no_script]='%s %s ‚Äî —Å–∫—Ä–∏–ø—Ç %s –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º'
```

–í—ã–∑–æ–≤:
```bash
say no_script "$DISTRO" "$VERSION" "$TARGET"
```

–í—ã–≤–æ–¥:
```bash
Ubuntu 22.04 ‚Äî —Å–∫—Ä–∏–ø—Ç backup-system.sh –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
```

## 4Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π


```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –∏ –ø—ã—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ
check_and_install_deps rsync tar gzip pv
```

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ `command -v`
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø–∞–∫–µ—Ç–Ω—ã–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã: `apt-get`, `dnf`, `yum`, `pacman`, `zypper`
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–∞–∫–µ—Ç—ã —á–µ—Ä–µ–∑ warn
- –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è `[OK]`

## 5Ô∏è‚É£ –¶–≤–µ—Ç–∞ –∏ –ø–æ—Ç–æ–∫–∏


| –§—É–Ω–∫—Ü–∏—è | –¶–≤–µ—Ç     | –ü–æ—Ç–æ–∫   | –ö–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ |
|---------|----------|---------|--------------|
| ok      | –∑–µ–ª—ë–Ω—ã–π  | stdout  | 0            |
| info    | —Å–∏–Ω–∏–π    | stdout  | 0            |
| warn    | –∂—ë–ª—Ç—ã–π   | stderr  | 0            |
| error   | –∫—Ä–∞—Å–Ω—ã–π  | stderr  | 1            |
| die     | –∫—Ä–∞—Å–Ω—ã–π  | stderr  | –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ (1 –∏–ª–∏ –∑–∞–¥–∞–Ω–Ω—ã–π) |

- –¶–≤–µ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è, –µ—Å–ª–∏ `stdout` –Ω–µ `tty` –∏–ª–∏ `FORCE_COLOR=0`
- –õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `RUN_LOG`, –µ—Å–ª–∏ –∑–∞–¥–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è

## 6Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞


```bash
#!/usr/bin/env bash

LIB_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/lib" && pwd)"
source "$LIB_DIR/logging.sh"
source "$LIB_DIR/deps.sh"

# —è–∑—ã–∫
LANG_CODE=ru
load_messages "$LANG_CODE"

# –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
check_and_install_deps rsync tar gzip pv

# –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
ok "–°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ"
info "–ù–∞—á–∏–Ω–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ..."
warn "–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –ø–∞–∫–µ—Ç–æ–≤"
error "–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å–∫—Ä–∏–ø—Ç"
die 1 "–§–∞—Ç–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞"
```